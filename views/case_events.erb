<%= erb :menu, locals: { pageid: 'home' } %>

<% content_for :breadcrumbs do %>
<a href="/">Home</a> &gt; <a href="/postcodes/<%=url_format postcode %>"><%=h postcode %></a> &gt; <a href="/addresses/<%=h uprn %>/cases">Cases</a> &gt; Case <%=h case_id %>
<% end %>

<% content_for :sidebar do %>
  <%= erb :googlemaps_partial, locals: { coordinates: coordinates } %>
<% end %>

<% if case_state == 'ACTIONABLE' || case_state == 'INACTIONABLE' %>

  <% if respondent_type == 'H' %>
    <form action="/cases/<%=h case_id %>/uprn/<%=h uprn %>/sample/<%=h sample_id %>/request/individual/new" method="get">
      <input class="button" type="submit" value="Request Individual Form&hellip;">
      <% if params[:actionpage].present? %>
        <input type="hidden" name="page" value="<%=h params[:actionpage] %>">
      <% end %>
    </form>
  <% end %>


  <% if isOnline %>
    <% unless respondent_type == 'C' %>
      <form action="/cases/<%=h case_id %>/uprn/<%=h uprn %>/sample/<%=h sample_id %>/request/iac/new" method="get">
        <input class="button" type="submit" value="Request Replacement IAC&hellip;">
      <% if params[:actionpage].present? %>
        <input type="hidden" name="page" value="<%=h params[:actionpage] %>">
      <% end %>
      </form>
    <% end %>
  <% end %>

  <% unless respondent_type == "C" %>
    <form action="/cases/<%=h case_id %>/uprn/<%=h uprn %>/sample/<%=h sample_id %>/translate/new" method="get">
      <input class="button" type="submit" value="Request Translation Booklet&hellip;">
      <% if params[:actionpage].present? %>
        <input type="hidden" name="page" value="<%=h params[:actionpage] %>">
      <% end %>
    </form>
  <% end %>

  <% if isPaper %>
    <% if respondent_type == 'H' || respondent_type == 'HI' %>
      <form action="/cases/<%=h case_id %>/uprn/<%=h uprn %>/sample/<%=h sample_id %>/request/paper/new" method="get">
        <input class="button" type="submit" value="Request Paper Form&hellip;">
      <% if params[:actionpage].present? %>
        <input type="hidden" name="page" value="<%=h params[:actionpage] %>">
      <% end %>
      </form>
    <% end %>
  <% end %>

<% end %>

  <table class="primary">
    <thead>
      <tr>
        <th>Case Status</th>
        <th>Case Created</th>
        <th>Survey Description</th>
        <th>Sample Name</th>
        <th>Address Line 1</th>
        <th>Address Line 2</th>
        <th>Town</th>
        <th>Postcode</th>
        <th>Address Type</th>
        <th>Establishment Type</th>
      </tr>
    </thead>
    <tbody>
      <tr class="even">
        <% if kase['state'].present? %>
      <td><%=h kase['state'] %></td>
      <% else %>
        <td>-</td>
      <% end %>
      <% if kase['createdDateTime'].present? %>
        <td><%=h kase['createdDateTime'].to_date %></td>
      <% else %>
        <td>-</td>
      <% end %>
      <% if survey.present? %>
        <td><%=h survey %></td>
      <% else %>
        <td>-</td>
      <% end %>
      <% if sample['name'].present? %>
        <td><%=h sample['name'] %></td>
      <% else %>
        <td>-</td>
      <% end %>
      <% if address['line1'].present? %>
          <td><%=h address['line1'] %></td>
      <% else %>
        <td>-</td>
      <% end %>
      <% if address['line2'].present? %>
        <td><%=h address['line2'] %></td>
      <% else %>
        <td>-</td>
      <% end %>
      <% if address['townName'].present? %>
        <td><%=h address['townName'] %></td>
      <% else %>
        <td>-</td>
      <% end %>
      <% if address['postcode'].present? %>
        <td><%=h address['postcode'] %></td>
      <% else %>
        <td>-</td>
      <% end %>
      <% if address['type'].present? %>
        <td><%=h address['type'].to_address_type %></td>
      <% else %>
        <td>-</td>
      <% end %>
      <% if address['estabtype'].present? %>
        <td><%=h address['estabtype'] %></td>
      <% else %>
        <td>-</td>
      <% end %>
    </tr>
    </tbody>
  </table>

<h3>Questionnaires</h3>

<table class="secondary">
  <thead>
    <tr>
      <th>Case Reference</th>
      <th>Dispatch Date</th>
      <th>Response Date</th>
      <th>Question Set</th>
    </tr>
  </thead>
  <tbody>
  <% if responses.any? %>
    <% responses.each_with_index do |response, i| %>
      <tr class="<%= i.even? ? 'even' : 'odd ' %>">
        <td><%=h kase['caseRef'] %></td>
      <% if kase['createdDateTime'] %>
        <td><%=h kase['createdDateTime'].to_date %></td>
      <% else %>
        <td>-</td>
      <% end %>
      <% if response['dateTime'] %>
        <td><%=h response['dateTime'].to_date %></td>
      <% else %>
        <td>-</td>
      <% end %>
      <% if question_set %>
        <td><%=h question_set %></td>
      <% else %>
        <td>-</td>
      <% end %>
      </tr>
    <% end %>
  <%else%>
    <tr class="even">
      <td><%=h kase['caseRef'] %></td>
    <% if kase['createdDateTime'] %>
      <td><%=h kase['createdDateTime'].to_date %></td>
    <% else %>
      <td>-</td>
    <% end %>
    <td>-</td>
    <% if question_set %>
      <td><%=h question_set %></td>
    <% else %>
      <td>-</td>
    <% end %>
    </tr>
  <%end%>
  </tbody>
</table>

<% content_for :footer do %>

  <h3>Events</h3>
  <div id="events">
    <form action="/cases/<%=h case_id %>/uprn/<%=h uprn %>/sample/<%=h sample_id %>/event/new" method="get">
      <input class="button" type="submit" value="Create Event&hellip;"> or <% if params[:actionpage].present? %><a href="/addresses/<%=h uprn %>/questionnaires?page=<%=h params[:actionpage] %>"><% else %><a href="/cases/<%=h case_id %>/uprn/<%=h uprn %>/sample/<%=h sample_id %>"><% end %>Refresh</a>
      <% if params[:actionpage].present? %>
        <input type="hidden" name="page" value="<%=h params[:actionpage] %>">
      <% end %>
    </form>
  </div>

  <% if events.any? %>
    <%= will_paginate events, :previous_label => '&lt; Prev', :next_label => 'Next &gt;' %>
    <table class="secondary">
      <thead>
        <tr>
          <th>Case Event ID</th>
          <th>Created Date</th>
          <th>Created By</th>
          <th>Event Category</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
      <% events.each_with_index do |events, i| %>
        <tr class="<%= i.even? ? 'even' : 'odd ' %>">
        <% if events['caseEventId'] %>
          <td><%=h events['caseEventId'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if events['createdDateTime'] %>
          <td><%=h events['createdDateTime'].to_date %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if events['createdBy'] %>
          <td><%=h events['createdBy'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if events['categoryName'] %>
          <td><%=h events['categoryName'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if events['description'] %>
          <td><%=h events['description'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        </tr>
      <% end %>
      </tbody>
    </table>
    <%= will_paginate events, :previous_label => '&lt; Prev', :next_label => 'Next &gt;' %>

  <% content_for :footer do %>
    <h3>Actions</h3>
  <% if actions.any? %>
    <table class="secondary">
      <thead>
        <tr>
          <th>Action ID</th>
          <th>Action Type</th>
          <th>Created By</th>
          <th>State</th>
          <th>Created Date</th>
        </tr>
      </thead>
      <tbody>
      <% actions.each_with_index do |action, i| %>
        <tr class="<%= i.even? ? 'even' : 'odd ' %>">
        <% if action['actionId'] %>
          <td><%=h action['actionId'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if action['actionTypeName'] %>
          <td><%=h action['actionTypeName'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if action['createdBy'] %>
          <td><%=h action['createdBy'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if action['state'] %>
          <td><%=h action['state'].to_title_case %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if action['createdDateTime'] %>
          <td><%=h action['createdDateTime'].to_date %></td>
        <% else %>
          <td>-</td>
        <% end %>
        </tr>
      <% end %>
      </tbody>
    </table>
  <% else %>
    <p id="information"><strong>There are no actions for this case.</strong></p>
  <% end %>
  <% end %>
  <% else %>
    <p id="information"><strong>There are no events for this case.</strong></p>
  <% end %>
<% end %>
